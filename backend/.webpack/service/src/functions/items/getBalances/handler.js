(()=>{"use strict";var e={981:(e,r,t)=>{t.d(r,{q:()=>n});var o=t(512);const n=e=>{switch(e){case o.V.SANDBOX:return process.env.ITEMS_TABLE_PLAID_SANDBOX;case o.V.DEVELOPMENT:return process.env.ITEMS_TABLE_PLAID_DEVELOPMENT;case o.V.PRODUCTION:return process.env.ITEMS_TABLE_PLAID_PRODUCTION;default:return process.env.ITEMS_TABLE_PLAID_SANDBOX}}},963:(e,r,t)=>{t.d(r,{F:()=>n});var o=t(597);const n=e=>new o.Client({clientID:e.client_id,secret:e.secret,env:o.environments[e.env],options:{version:"2019-05-29"}})},782:(e,r,t)=>{t.d(r,{L:()=>o});const o=(e,r)=>({statusCode:e,body:JSON.stringify(r),headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":!0}})},444:(e,r,t)=>{t.d(r,{z:()=>c});var o=t(806),n=t.n(o),s=t(657),a=t.n(s);const c=e=>n()(e).use(a()())},512:(e,r,t)=>{var o;t.d(r,{V:()=>o}),function(e){e.SANDBOX="sandbox",e.DEVELOPMENT="development",e.PRODUCTION="production"}(o||(o={}))},474:(e,r,t)=>{t.d(r,{X:()=>o});const o=(e,r)=>e.filter((e=>e.Name==r))[0].Value},806:e=>{e.exports=require("@middy/core")},657:e=>{e.exports=require("@middy/http-json-body-parser")},480:e=>{e.exports=require("aws-sdk")},597:e=>{e.exports=require("plaid")},43:e=>{e.exports=require("source-map-support/register")}},r={};function t(o){var n=r[o];if(void 0!==n)return n.exports;var s=r[o]={exports:{}};return e[o](s,s.exports,t),s.exports}t.n=e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return t.d(r,{a:r}),r},t.d=(e,r)=>{for(var o in r)t.o(r,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:r[o]})},t.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),t.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var o={};(()=>{t.r(o),t.d(o,{main:()=>u}),t(43);var e=t(782),r=t(444),n=t(480),s=t(981),a=t(474),c=t(963);const l=new n.DynamoDB.DocumentClient,i=new n.SSM,u=(0,r.z)((async(r,t)=>{let o,n=r.requestContext.authorizer.claims.sub;console.log(1);try{o=(await i.getParametersByPath({Path:process.env.PARAMETERS_PATH}).promise()).Parameters}catch(r){return console.log(r),(0,e.L)(500,null)}console.log(2);const u=(0,s.q)((0,a.X)(o,process.env.PLAID_ENV_PATH));let d,p=r.body.itemId;if(!p||"string"!=typeof p)return(0,e.L)(400,{error:"Invalid itemId provided"});try{let r={TableName:u,Key:{userId:n,itemId:p}};console.log(r);let t=await l.get(r).promise();if(d={...t.Item},console.log(4),null==!t.Item)return(0,e.L)(500,null)}catch(r){return console.log(5),console.log(r),(0,e.L)(500,null)}let v,_=(0,c.F)({client_id:(0,a.X)(o,process.env.PLAID_CLIENT_ID_PATH),secret:(0,a.X)(o,process.env.PLAID_SECRET_PATH),env:(0,a.X)(o,process.env.PLAID_ENV_PATH)});try{let e=await _.getBalance(d.accessToken);console.log(6),v=e.accounts}catch(r){return console.log(r),console.log(7),(0,e.L)(500,null)}let m=[];v.forEach((e=>{m.push({accountId:e.account_id,balances:{current:e.balances.current,available:e.balances.available,isoCurrencyCode:e.balances.iso_currency_code},mask:e.mask,name:e.name,officialName:e.official_name,type:e.type,subtype:e.subtype})}));var y={TableName:u,Key:{userId:n,itemId:p},UpdateExpression:"set accounts = :a",ExpressionAttributeValues:{":a":m},ReturnValues:"UPDATED_NEW"};console.log(y);try{return await l.update(y).promise(),delete d.accessToken,(0,e.L)(200,{...d,accounts:m})}catch(r){return console.log(r),(0,e.L)(500,null)}}))})();var n=exports;for(var s in o)n[s]=o[s];o.__esModule&&Object.defineProperty(n,"__esModule",{value:!0})})();
//# sourceMappingURL=handler.js.map